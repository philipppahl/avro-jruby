#!/usr/bin/env jruby

require 'java'

raise "\n\n\tUsage:  catavro <avrofile>\n" unless ARGV.length == 1

# Grok where we are, allows for symlinks
this = File.expand_path(__FILE__)
this = File.expand_path(File.readlink(__FILE__)) if File.symlink?(__FILE__)
avro_jar_dir = File.expand_path(this+'/../../jars')

# Require avro jars
Dir["#{avro_jar_dir}/*.jar"].each{|jar| require jar}

java_import 'org.apache.avro.generic.GenericDatumReader'
java_import 'org.apache.avro.file.DataFileReader'
java_import 'org.apache.avro.io.BinaryEncoder'
java_import 'org.apache.avro.generic.GenericData'
java_import 'org.apache.avro.util.Utf8'

fin         = java.io.File.new(ARGV[0])
reader      = GenericDatumReader.new
file_reader = DataFileReader.new(fin, reader)
file_reader.each do |record|
  puts record.to_s
end
